<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chinasofti.cetp.ability.dao.SelfEvaluationMapper" >
  <resultMap id="BaseResultMap" type="com.chinasofti.cetp.ability.model.SelfEvaluation" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    <id column="SEV_ID" property="sevId" jdbcType="INTEGER" />
    <result column="SEV_EVAL_ID" property="sevEvalId" jdbcType="INTEGER" />
    <result column="SEV_ABI_ID" property="sevAbiId" jdbcType="INTEGER" />
    <result column="SEV_STU_ID" property="sevStuId" jdbcType="INTEGER" />
    <result column="SEV_VALUE" property="sevValue" jdbcType="INTEGER" />
    <result column="SEV_REGTIME" property="sevRegtime" jdbcType="TIMESTAMP" />
  </resultMap>
  <resultMap id="selfResultMap" type="com.chinasofti.cetp.ability.model.MoreSelfEvaluation" >
    <id column="SEV_ID" property="sevId" jdbcType="INTEGER" />
    <result column="SEV_EVAL_ID" property="sevEvalId" jdbcType="INTEGER" />
    <result column="SEV_ABI_ID" property="sevAbiId" jdbcType="INTEGER" />
    <result column="SEV_STU_ID" property="sevStuId" jdbcType="INTEGER" />
    <result column="SEV_VALUE" property="sevValue" jdbcType="INTEGER" />
    <result column="SEV_REGTIME" property="sevRegtime" jdbcType="TIMESTAMP" />
    <result column="ABI_ID" property="abiId" jdbcType="INTEGER" />
    <result column="ABI_NAME" property="abiName" jdbcType="VARCHAR" />
    <result column="AB_ID" property="abId" jdbcType="INTEGER" />
    <result column="AB_NAME" property="abName" jdbcType="VARCHAR" />
    <result column="AB_SCORE" property="abScore" jdbcType="INTEGER" />
    <result column="PROF_ID" property="profId" jdbcType="INTEGER" />
    <result column="PROF_NAME" property="profName" jdbcType="VARCHAR" />
    <result column="WAITABNAME" property="waitAbName" jdbcType="VARCHAR" />
  </resultMap>
  <select id="selectSelfType" resultMap="selfResultMap" parameterType="HashMap" >
 	select 
 	    DISTINCT
 	    f.PROF_ID PROF_ID
 	    ,f.PROF_NAME PROF_NAME
	    ,e.ABI_ID ABI_ID
	    ,e.ABI_NAME ABI_NAME
	from 
	    tp_profession_pability a
	    ,tp_profession f
	    ,tp_pab_wcon b 
	    ,tp_wcon_abitem c
	    ,tp_ability_item d
	    ,tp_ability e
	where 
	    a.PROF_ID =f.PROF_ID
	    and a.PAPI_PAB_ID = b.PABW_PAB_ID 
	    and b.PABW_WCON_ID = c.WCDB_WCON_ID
	    and c.WCDB_ABITEM_ID = d.AB_ID
	    and d.AB_PARENT_ID = e.ABI_ID
	    <if test="profId != null">
	    	 and a.PROF_ID = #{profId,jdbcType=INTEGER}
	    </if>
	    <if test="stuId!=null and profId == null">
			and a.PROF_ID = (select 
	    	                       c.EVAL_PROF_ID 
	    	                 from 
	    	                       tp_evaluation c 
	    	                 where 
	    	                        c.EVAL_STU_ID = #{stuId,jdbcType=INTEGER}  
	    	                 order by 
	    	                          c.EVAL_REGTIME desc 
	    	                          limit 1)
	   </if>
  </select>
  <select id="selectSelfItem" resultMap="selfResultMap" parameterType="java.lang.Integer" >
   		select 
		     a.AB_ID AB_ID
		     ,a.AB_NAME AB_NAME
		     ,a.AB_SCORE AB_SCORE
		from 
		    tp_ability_item a
		    ,tp_ability b
		where 
		    a.AB_PARENT_ID = b.ABI_ID
		    and b.ABI_ID =#{selAbiId}
  </select>
  <select id="selectExitEval" resultMap="selfResultMap" parameterType="HashMap" >
  		select
  		     EVAL_ID as SEV_EVAL_ID
  		from
  		     tp_evaluation
  		where
  		     EVAL_PROF_ID = #{profId,jdbcType=INTEGER}  
  		     and EVAL_STU_ID = #{stuId,jdbcType=INTEGER}
  </select>
  <select id="selectProf" resultMap="selfResultMap" parameterType="HashMap" >
  		select
  		     a.EVAL_ID as SEV_EVAL_ID
  		     ,b.PROF_NAME as PROF_NAME
  		from
  		     tp_evaluation a
  		     ,tp_profession b
  		where
  		     a.EVAL_PROF_ID = b.PROF_ID
  		     and a.EVAL_PROF_ID = #{profId,jdbcType=INTEGER}  
  		     and a.EVAL_STU_ID = #{stuId,jdbcType=INTEGER}
  </select>
  <insert id="insertSaveEvaluation" parameterType="HashMap">
	    insert into 
	   			tp_evaluation(
						        EVAL_PROF_ID
						        ,EVAL_STU_ID
						        ,EVAL_REGTIME
						      )
		               values(
		               			#{evalProfId,jdbcType=INTEGER}
		               			,#{stuid,jdbcType=INTEGER}
		               			,now()
		               		 )
  </insert>
  <select id="selectExitSelfEvaluation"  resultMap="selfResultMap" parameterType="HashMap">
	    select 
	            a.SEV_EVAL_ID
	    from 
	   			tp_self_evaluation a
	   			,tp_evaluation b
		where
		     a.SEV_EVAL_ID = b.EVAL_ID
     		 and b.EVAL_PROF_ID = #{profId,jdbcType=INTEGER}  
  		     and b.EVAL_STU_ID = #{stuId,jdbcType=INTEGER}    		
  </select>
  <update id="updateSaveSelfEvaluation" parameterType="HashMap">
	    update 
	   			tp_self_evaluation
	   	set
	   			SEV_VALUE = #{sevValue,jdbcType=INTEGER}
				,SEV_REGTIME = now()
		where
       			SEV_EVAL_ID = #{sevEvalId,jdbcType=INTEGER}
       			and SEV_ABI_ID = #{sevAbiId,jdbcType=INTEGER}
       			and SEV_STU_ID = #{sevStuId,jdbcType=INTEGER}               		
  </update>
  <insert id="insertSaveSelfEvaluation" parameterType="HashMap">
	    insert into 
	   			tp_self_evaluation(
						        SEV_EVAL_ID
						        ,SEV_ABI_ID
						        ,SEV_STU_ID
						        ,SEV_VALUE
						        ,SEV_REGTIME
						      )
		               values(
		               			#{sevEvalId,jdbcType=INTEGER}
		               			,#{sevAbiId,jdbcType=INTEGER}
		               			,#{sevStuId,jdbcType=INTEGER}
		               			,#{sevValue,jdbcType=INTEGER}
		               			,now()
		               		 )
  </insert>
  <select id="selectStandard" resultMap="selfResultMap" parameterType="HashMap" >
 	select 
 	    DISTINCT
 	    f.PROF_ID PROF_ID
 	    ,f.PROF_NAME PROF_NAME
	    ,e.ABI_ID ABI_ID
	    ,e.ABI_NAME ABI_NAME
	    ,d.AB_NAME  AB_NAME
	    ,d.AB_SCORE AB_SCORE
	from 
	    tp_profession_pability a
	    ,tp_profession f
	    ,tp_pab_wcon b 
	    ,tp_wcon_abitem c
	    ,tp_ability_item d
	    ,tp_ability e
	where 
	    a.PROF_ID =f.PROF_ID
	    and a.PAPI_PAB_ID = b.PABW_PAB_ID 
	    and b.PABW_WCON_ID = c.WCDB_WCON_ID
	    and c.WCDB_ABITEM_ID = d.AB_ID
	    and d.AB_PARENT_ID = e.ABI_ID
	    <if test="profId != null">
	    	 and a.PROF_ID = #{profId,jdbcType=INTEGER}
	    </if>
	    <if test="stuId!=null and profId == null">
			and a.PROF_ID = (select 
	    	                       c.EVAL_PROF_ID 
	    	                 from 
	    	                       tp_evaluation c 
	    	                 where 
	    	                        c.EVAL_STU_ID = #{stuId,jdbcType=INTEGER}  
	    	                 order by 
	    	                          c.EVAL_REGTIME desc 
	    	                          limit 1)
	   </if>
  </select>
  <select id="selectSelfEvaluation"  resultMap="selfResultMap" parameterType="HashMap">
	    select
		        a.SEV_EVAL_ID SEV_EVAL_ID
		        ,a.SEV_ABI_ID SEV_ABI_ID
		        ,a.SEV_STU_ID SEV_STU_ID
		        ,a.SEV_VALUE SEV_VALUE
		        ,a.SEV_REGTIME SEV_REGTIME
		        ,b.ABI_NAME ABI_NAME
		from 
		        tp_self_evaluation a
		        ,tp_ability b
		where 
				a.SEV_ABI_ID = b.ABI_ID
				<if test="selSevEvalId==null">
				   and a.SEV_EVAL_ID = (select 
			    	                       c.EVAL_ID
			    	                 from 
			    	                       tp_evaluation c 
			    	                 where 
			    	                        c.EVAL_STU_ID = #{stuId,jdbcType=INTEGER}  
			    	                 order by 
			    	                          c.EVAL_REGTIME desc 
			    	                          limit 1)
			   </if>
			   <if test="selSevEvalId!=null">
			   		and a.SEV_EVAL_ID = #{selSevEvalId,jdbcType=INTEGER}
			   </if>               			
  </select>
  <select id="selectRatioEvaluation"  resultMap="selfResultMap" parameterType="HashMap">
      	select
      	    DISTINCT
	        a.SEV_EVAL_ID SEV_EVAL_ID
	        ,a.SEV_ABI_ID SEV_ABI_ID
	        ,a.SEV_STU_ID SEV_STU_ID
	        ,a.SEV_VALUE SEV_VALUE
	        ,a.SEV_REGTIME SEV_REGTIME
           ,h.AB_SCORE AB_SCORE
           ,if((a.SEV_VALUE-h.AB_SCORE)>=0,'',h.AB_NAME) WAITABNAME
           ,d.PROF_NAME PROF_NAME
           ,i.ABI_NAME ABI_NAME
		from 
		    tp_self_evaluation a
            ,tp_evaluation b
            ,tp_profession d
            ,tp_profession_pability e
            ,tp_pab_wcon f 
            ,tp_wcon_abitem g
            ,tp_ability_item h
            ,tp_ability i
	   where
	       a.SEV_EVAL_ID = b.EVAL_ID
	       and b.EVAL_PROF_ID = d.PROF_ID
	       and d.PROF_ID = e.PROF_ID
		   and e.PAPI_PAB_ID =  f.PABW_PAB_ID
		   and f.PABW_WCON_ID = g.WCDB_WCON_ID
	       and g.WCDB_ABITEM_ID = h.AB_ID
	       and h.AB_PARENT_ID = i.ABI_ID
	       <if test="selSevEvalId==null">
			   and a.SEV_EVAL_ID = (select 
		    	                       c.EVAL_ID
		    	                 from 
		    	                       tp_evaluation c 
		    	                 where 
		    	                        c.EVAL_STU_ID = #{stuId,jdbcType=INTEGER}
		    	                 order by 
		    	                          c.EVAL_REGTIME desc 
		    	                          limit 1)
		   </if>
		   <if test="selSevEvalId!=null">
		   		and a.SEV_EVAL_ID = #{selSevEvalId,jdbcType=INTEGER}
		   </if>               			
  </select>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    SEV_ID, SEV_EVAL_ID, SEV_ABI_ID, SEV_STU_ID, SEV_VALUE, SEV_REGTIME
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.chinasofti.cetp.ability.model.SelfEvaluationExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from tp_self_evaluation
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    from tp_self_evaluation
    where SEV_ID = #{sevId,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    delete from tp_self_evaluation
    where SEV_ID = #{sevId,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.chinasofti.cetp.ability.model.SelfEvaluationExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    delete from tp_self_evaluation
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.chinasofti.cetp.ability.model.SelfEvaluation" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    insert into tp_self_evaluation (SEV_ID, SEV_EVAL_ID, SEV_ABI_ID, 
      SEV_STU_ID, SEV_VALUE, SEV_REGTIME
      )
    values (#{sevId,jdbcType=INTEGER}, #{sevEvalId,jdbcType=INTEGER}, #{sevAbiId,jdbcType=INTEGER}, 
      #{sevStuId,jdbcType=INTEGER}, #{sevValue,jdbcType=INTEGER}, #{sevRegtime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.chinasofti.cetp.ability.model.SelfEvaluation" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    insert into tp_self_evaluation
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="sevId != null" >
        SEV_ID,
      </if>
      <if test="sevEvalId != null" >
        SEV_EVAL_ID,
      </if>
      <if test="sevAbiId != null" >
        SEV_ABI_ID,
      </if>
      <if test="sevStuId != null" >
        SEV_STU_ID,
      </if>
      <if test="sevValue != null" >
        SEV_VALUE,
      </if>
      <if test="sevRegtime != null" >
        SEV_REGTIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="sevId != null" >
        #{sevId,jdbcType=INTEGER},
      </if>
      <if test="sevEvalId != null" >
        #{sevEvalId,jdbcType=INTEGER},
      </if>
      <if test="sevAbiId != null" >
        #{sevAbiId,jdbcType=INTEGER},
      </if>
      <if test="sevStuId != null" >
        #{sevStuId,jdbcType=INTEGER},
      </if>
      <if test="sevValue != null" >
        #{sevValue,jdbcType=INTEGER},
      </if>
      <if test="sevRegtime != null" >
        #{sevRegtime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.chinasofti.cetp.ability.model.SelfEvaluationExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    select count(*) from tp_self_evaluation
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    update tp_self_evaluation
    <set >
      <if test="record.sevId != null" >
        SEV_ID = #{record.sevId,jdbcType=INTEGER},
      </if>
      <if test="record.sevEvalId != null" >
        SEV_EVAL_ID = #{record.sevEvalId,jdbcType=INTEGER},
      </if>
      <if test="record.sevAbiId != null" >
        SEV_ABI_ID = #{record.sevAbiId,jdbcType=INTEGER},
      </if>
      <if test="record.sevStuId != null" >
        SEV_STU_ID = #{record.sevStuId,jdbcType=INTEGER},
      </if>
      <if test="record.sevValue != null" >
        SEV_VALUE = #{record.sevValue,jdbcType=INTEGER},
      </if>
      <if test="record.sevRegtime != null" >
        SEV_REGTIME = #{record.sevRegtime,jdbcType=TIMESTAMP},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    update tp_self_evaluation
    set SEV_ID = #{record.sevId,jdbcType=INTEGER},
      SEV_EVAL_ID = #{record.sevEvalId,jdbcType=INTEGER},
      SEV_ABI_ID = #{record.sevAbiId,jdbcType=INTEGER},
      SEV_STU_ID = #{record.sevStuId,jdbcType=INTEGER},
      SEV_VALUE = #{record.sevValue,jdbcType=INTEGER},
      SEV_REGTIME = #{record.sevRegtime,jdbcType=TIMESTAMP}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.chinasofti.cetp.ability.model.SelfEvaluation" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    update tp_self_evaluation
    <set >
      <if test="sevEvalId != null" >
        SEV_EVAL_ID = #{sevEvalId,jdbcType=INTEGER},
      </if>
      <if test="sevAbiId != null" >
        SEV_ABI_ID = #{sevAbiId,jdbcType=INTEGER},
      </if>
      <if test="sevStuId != null" >
        SEV_STU_ID = #{sevStuId,jdbcType=INTEGER},
      </if>
      <if test="sevValue != null" >
        SEV_VALUE = #{sevValue,jdbcType=INTEGER},
      </if>
      <if test="sevRegtime != null" >
        SEV_REGTIME = #{sevRegtime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where SEV_ID = #{sevId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.chinasofti.cetp.ability.model.SelfEvaluation" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 09 09:51:47 CST 2013.
    -->
    update tp_self_evaluation
    set SEV_EVAL_ID = #{sevEvalId,jdbcType=INTEGER},
      SEV_ABI_ID = #{sevAbiId,jdbcType=INTEGER},
      SEV_STU_ID = #{sevStuId,jdbcType=INTEGER},
      SEV_VALUE = #{sevValue,jdbcType=INTEGER},
      SEV_REGTIME = #{sevRegtime,jdbcType=TIMESTAMP}
    where SEV_ID = #{sevId,jdbcType=INTEGER}
  </update>
</mapper>